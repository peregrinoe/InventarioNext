<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inventario - Almacenamiento Local</title>
    <link rel="stylesheet" href="./main.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üíª Sistema de Inventario</h1>
            <p>Gesti√≥n de Equipos de C√≥mputo - Almacenamiento Local</p>
        </header>
        
        <div class="backup-controls">
            <div class="info">
                <strong>üíæ Almacenamiento:</strong> Los datos se guardan autom√°ticamente en tu navegador
            </div>
            <button class="btn btn-success" onclick="exportarDatos()">üì• Exportar Datos (JSON)</button>
            <button class="btn btn-info" onclick="document.getElementById('fileInput').click()">üì§ Importar Datos</button>
            <input type="file" id="fileInput" accept=".json" onchange="importarDatos(event)">
        </div>
        
        <nav class="main-nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">
                üìä Dashboard
            </button>
            <button class="nav-btn" onclick="showSection('colaboradores')">
                üë• Colaboradores
            </button>
            <button class="nav-btn" onclick="showSection('equipos')">
                üíª Equipos
            </button>
            <button class="nav-btn" onclick="showSection('asignaciones')">
                üîó Asignaciones
            </button>
        </nav>
        
        <div class="content-area">
            <!-- DASHBOARD -->
            <section id="dashboard" class="section active">
                <div class="section-header">
                    <h2>Dashboard</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Colaboradores</h3>
                        <div class="stat-value" id="totalColaboradores">0</div>
                    </div>
                    <div class="stat-card equipos">
                        <h3>Total Equipos</h3>
                        <div class="stat-value" id="totalEquipos">0</div>
                    </div>
                    <div class="stat-card asignados">
                        <h3>Equipos Asignados</h3>
                        <div class="stat-value" id="equiposAsignados">0</div>
                    </div>
                    <div class="stat-card disponibles">
                        <h3>Equipos Disponibles</h3>
                        <div class="stat-value" id="equiposDisponibles">0</div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 15px; color: #1e293b;">Asignaciones Recientes</h3>
                <div class="table-container">
                    <table id="dashboardTable">
                        <thead>
                            <tr>
                                <th>Colaborador</th>
                                <th>Equipo</th>
                                <th>Tipo</th>
                                <th>Fecha Asignaci√≥n</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="dashboardTableBody">
                            <tr>
                                <td colspan="5" class="empty-state">
                                    <div class="empty-state-icon">üìã</div>
                                    <h3>No hay asignaciones a√∫n</h3>
                                    <p>Comienza creando colaboradores y equipos</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- COLABORADORES -->
            <section id="colaboradores" class="section">
                <div class="section-header">
                    <h2>Colaboradores</h2>
                    <button class="btn btn-primary" onclick="openModal('modalColaborador')">
                        ‚ûï Nuevo Colaborador
                    </button>
                </div>
                
                <div class="search-box">
                    <input type="text" id="searchColaborador" placeholder="üîç Buscar colaborador..." onkeyup="filterColaboradores()">
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Departamento</th>
                                <th>Puesto</th>
                                <th>Equipos Asignados</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="colaboradoresTableBody">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <div class="empty-state-icon">üë•</div>
                                    <h3>No hay colaboradores registrados</h3>
                                    <p>Haz clic en "Nuevo Colaborador" para comenzar</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- EQUIPOS -->
            <section id="equipos" class="section">
                <div class="section-header">
                    <h2>Equipos de C√≥mputo</h2>
                    <button class="btn btn-primary" onclick="openModal('modalEquipo')">
                        ‚ûï Nuevo Equipo
                    </button>
                </div>
                
                <div class="search-box">
                    <input type="text" id="searchEquipo" placeholder="üîç Buscar equipo..." onkeyup="filterEquipos()">
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Marca</th>
                                <th>Modelo</th>
                                <th>Tipo</th>
                                <th>N¬∞ Serie</th>
                                <th>Estado</th>
                                <th>Asignado a</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="equiposTableBody">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <div class="empty-state-icon">üíª</div>
                                    <h3>No hay equipos registrados</h3>
                                    <p>Haz clic en "Nuevo Equipo" para comenzar</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- ASIGNACIONES -->
            <section id="asignaciones" class="section">
                <div class="section-header">
                    <h2>Asignaciones</h2>
                    <button class="btn btn-primary" onclick="openModal('modalAsignacion')">
                        ‚ûï Nueva Asignaci√≥n
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Colaborador</th>
                                <th>Equipo</th>
                                <th>Fecha Asignaci√≥n</th>
                                <th>Fecha Devoluci√≥n</th>
                                <th>Estado</th>
                                <th>Observaciones</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="asignacionesTableBody">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <div class="empty-state-icon">üîó</div>
                                    <h3>No hay asignaciones registradas</h3>
                                    <p>Haz clic en "Nueva Asignaci√≥n" para comenzar</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
    
    <!-- MODAL COLABORADOR -->
    <div id="modalColaborador" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalColaboradorTitle">Nuevo Colaborador</h3>
                <button class="close-modal" onclick="closeModal('modalColaborador')">&times;</button>
            </div>
            <form id="formColaborador" onsubmit="saveColaborador(event)">
                <input type="hidden" id="colaboradorId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre Completo *</label>
                        <input type="text" id="colaboradorNombre" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="colaboradorEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="tel" id="colaboradorTelefono">
                    </div>
                    <div class="form-group">
                        <label>Departamento *</label>
                        <select id="colaboradorDepartamento" required>
                            <option value="">Seleccionar...</option>
                            <option value="Sistemas">Sistemas</option>
                            <option value="Recursos Humanos">Recursos Humanos</option>
                            <option value="Ventas">Ventas</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Finanzas">Finanzas</option>
                            <option value="Operaciones">Operaciones</option>
                            <option value="Administraci√≥n">Administraci√≥n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Puesto *</label>
                        <input type="text" id="colaboradorPuesto" required>
                    </div>
                    <div class="form-group">
                        <label>Fecha de Ingreso</label>
                        <input type="date" id="colaboradorFechaIngreso">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">üíæ Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalColaborador')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- MODAL EQUIPO -->
    <div id="modalEquipo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalEquipoTitle">Nuevo Equipo</h3>
                <button class="close-modal" onclick="closeModal('modalEquipo')">&times;</button>
            </div>
            <form id="formEquipo" onsubmit="saveEquipo(event)">
                <input type="hidden" id="equipoId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Tipo de Equipo *</label>
                        <select id="equipoTipo" required>
                            <option value="">Seleccionar...</option>
                            <option value="Laptop">Laptop</option>
                            <option value="Desktop">Desktop</option>
                            <option value="Monitor">Monitor</option>
                            <option value="Tablet">Tablet</option>
                            <option value="Impresora">Impresora</option>
                            <option value="Esc√°ner">Esc√°ner</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Marca *</label>
                        <input type="text" id="equipoMarca" required>
                    </div>
                    <div class="form-group">
                        <label>Modelo *</label>
                        <input type="text" id="equipoModelo" required>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Serie *</label>
                        <input type="text" id="equipoNumSerie" required>
                    </div>
                    <div class="form-group">
                        <label>Procesador</label>
                        <input type="text" id="equipoProcesador" placeholder="Ej: Intel i7">
                    </div>
                    <div class="form-group">
                        <label>RAM (GB)</label>
                        <input type="number" id="equipoRam" placeholder="8">
                    </div>
                    <div class="form-group">
                        <label>Almacenamiento</label>
                        <input type="text" id="equipoAlmacenamiento" placeholder="Ej: 512GB SSD">
                    </div>
                    <div class="form-group">
                        <label>Sistema Operativo</label>
                        <input type="text" id="equipoSO" placeholder="Ej: Windows 11">
                    </div>
                    <div class="form-group">
                        <label>Fecha de Compra</label>
                        <input type="date" id="equipoFechaCompra">
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <select id="equipoEstado" required>
                            <option value="Disponible">Disponible</option>
                            <option value="Asignado">Asignado</option>
                            <option value="Mantenimiento">Mantenimiento</option>
                            <option value="Baja">Baja</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Observaciones</label>
                    <textarea id="equipoObservaciones"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">üíæ Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalEquipo')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- MODAL ASIGNACI√ìN -->
    <div id="modalAsignacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Asignaci√≥n</h3>
                <button class="close-modal" onclick="closeModal('modalAsignacion')">&times;</button>
            </div>
            <form id="formAsignacion" onsubmit="saveAsignacion(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Colaborador *</label>
                        <select id="asignacionColaborador" required>
                            <option value="">Seleccionar colaborador...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Equipo *</label>
                        <select id="asignacionEquipo" required>
                            <option value="">Seleccionar equipo...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha de Asignaci√≥n *</label>
                        <input type="date" id="asignacionFecha" required>
                    </div>
                    <div class="form-group">
                        <label>Estado *</label>
                        <select id="asignacionEstado" required>
                            <option value="Activa">Activa</option>
                            <option value="Devuelto">Devuelto</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Observaciones</label>
                    <textarea id="asignacionObservaciones" placeholder="Condiciones, accesorios incluidos, etc."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">üíæ Asignar Equipo</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('modalAsignacion')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- NOTIFICACIONES -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Base de datos NoSQL simulada
        let database = {
            colaboradores: [],
            equipos: [],
            asignaciones: []
        };

        // Mostrar notificaci√≥n
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notification.className = `notification ${type} show`;
            notificationText.textContent = message;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Exportar datos a JSON
        function exportarDatos() {
            const dataStr = JSON.stringify(database, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `inventario_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('‚úÖ Datos exportados correctamente', 'success');
        }

        // Importar datos desde JSON
        function importarDatos(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validar estructura
                    if (importedData.colaboradores && importedData.equipos && importedData.asignaciones) {
                        database = importedData;
                        saveData();
                        
                        renderColaboradores();
                        renderEquipos();
                        renderAsignaciones();
                        updateDashboard();
                        
                        showNotification('‚úÖ Datos importados correctamente', 'success');
                    } else {
                        showNotification('‚ùå Archivo JSON inv√°lido', 'error');
                    }
                } catch (error) {
                    showNotification('‚ùå Error al leer el archivo', 'error');
                }
            };
            reader.readAsText(file);
            
            // Limpiar el input
            event.target.value = '';
        }

        // Cargar datos del localStorage
        function loadData() {
            const savedData = localStorage.getItem('inventarioDB');
            if (savedData) {
                database = JSON.parse(savedData);
            }
            updateDashboard();
            renderColaboradores();
            renderEquipos();
            renderAsignaciones();
        }

        // Guardar datos en localStorage
        function saveData() {
            localStorage.setItem('inventarioDB', JSON.stringify(database));
        }

        // Navegaci√≥n
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionName === 'asignaciones') {
                updateAsignacionSelects();
            }
        }

        // Modales
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            
            if (modalId === 'modalAsignacion') {
                updateAsignacionSelects();
                document.getElementById('asignacionFecha').valueAsDate = new Date();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId === 'modalColaborador') {
                document.getElementById('formColaborador').reset();
                document.getElementById('colaboradorId').value = '';
                document.getElementById('modalColaboradorTitle').textContent = 'Nuevo Colaborador';
            } else if (modalId === 'modalEquipo') {
                document.getElementById('formEquipo').reset();
                document.getElementById('equipoId').value = '';
                document.getElementById('modalEquipoTitle').textContent = 'Nuevo Equipo';
            } else if (modalId === 'modalAsignacion') {
                document.getElementById('formAsignacion').reset();
            }
        }

        // COLABORADORES
        function saveColaborador(event) {
            event.preventDefault();
            
            const id = document.getElementById('colaboradorId').value;
            const colaborador = {
                _id: id || 'COL' + Date.now(),
                nombre: document.getElementById('colaboradorNombre').value,
                email: document.getElementById('colaboradorEmail').value,
                telefono: document.getElementById('colaboradorTelefono').value,
                departamento: document.getElementById('colaboradorDepartamento').value,
                puesto: document.getElementById('colaboradorPuesto').value,
                fechaIngreso: document.getElementById('colaboradorFechaIngreso').value,
                createdAt: id ? database.colaboradores.find(c => c._id === id).createdAt : new Date().toISOString()
            };
            
            if (id) {
                const index = database.colaboradores.findIndex(c => c._id === id);
                database.colaboradores[index] = colaborador;
                showNotification('‚úÖ Colaborador actualizado');
            } else {
                database.colaboradores.push(colaborador);
                showNotification('‚úÖ Colaborador creado');
            }
            
            saveData();
            renderColaboradores();
            updateDashboard();
            closeModal('modalColaborador');
        }

        function renderColaboradores() {
            const tbody = document.getElementById('colaboradoresTableBody');
            
            if (database.colaboradores.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <h3>No hay colaboradores registrados</h3>
                            <p>Haz clic en "Nuevo Colaborador" para comenzar</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = database.colaboradores.map(col => {
                const equiposAsignados = database.asignaciones.filter(a => 
                    a.colaboradorId === col._id && a.estado === 'Activa'
                ).length;
                
                return `
                    <tr>
                        <td><strong>${col.nombre}</strong></td>
                        <td>${col.email}</td>
                        <td>${col.departamento}</td>
                        <td>${col.puesto}</td>
                        <td><span class="badge badge-info">${equiposAsignados} equipo(s)</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick='editColaborador("${col._id}")'>‚úèÔ∏è Editar</button>
                            <button class="btn btn-sm btn-danger" onclick='deleteColaborador("${col._id}")'>üóëÔ∏è Eliminar</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function editColaborador(id) {
            const colaborador = database.colaboradores.find(c => c._id === id);
            
            document.getElementById('colaboradorId').value = colaborador._id;
            document.getElementById('colaboradorNombre').value = colaborador.nombre;
            document.getElementById('colaboradorEmail').value = colaborador.email;
            document.getElementById('colaboradorTelefono').value = colaborador.telefono || '';
            document.getElementById('colaboradorDepartamento').value = colaborador.departamento;
            document.getElementById('colaboradorPuesto').value = colaborador.puesto;
            document.getElementById('colaboradorFechaIngreso').value = colaborador.fechaIngreso || '';
            
            document.getElementById('modalColaboradorTitle').textContent = 'Editar Colaborador';
            openModal('modalColaborador');
        }

        function deleteColaborador(id) {
            const asignaciones = database.asignaciones.filter(a => a.colaboradorId === id && a.estado === 'Activa');
            
            if (asignaciones.length > 0) {
                showNotification('‚ùå No se puede eliminar. El colaborador tiene equipos asignados.', 'error');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de eliminar este colaborador?')) {
                database.colaboradores = database.colaboradores.filter(c => c._id !== id);
                saveData();
                renderColaboradores();
                updateDashboard();
                showNotification('‚úÖ Colaborador eliminado');
            }
        }

        function filterColaboradores() {
            const searchTerm = document.getElementById('searchColaborador').value.toLowerCase();
            const rows = document.querySelectorAll('#colaboradoresTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // EQUIPOS
        function saveEquipo(event) {
            event.preventDefault();
            
            const id = document.getElementById('equipoId').value;
            const equipo = {
                _id: id || 'EQ' + Date.now(),
                tipo: document.getElementById('equipoTipo').value,
                marca: document.getElementById('equipoMarca').value,
                modelo: document.getElementById('equipoModelo').value,
                numSerie: document.getElementById('equipoNumSerie').value,
                especificaciones: {
                    procesador: document.getElementById('equipoProcesador').value,
                    ram: document.getElementById('equipoRam').value,
                    almacenamiento: document.getElementById('equipoAlmacenamiento').value,
                    sistemaOperativo: document.getElementById('equipoSO').value
                },
                fechaCompra: document.getElementById('equipoFechaCompra').value,
                estado: document.getElementById('equipoEstado').value,
                observaciones: document.getElementById('equipoObservaciones').value,
                createdAt: id ? database.equipos.find(e => e._id === id).createdAt : new Date().toISOString()
            };
            
            if (id) {
                const index = database.equipos.findIndex(e => e._id === id);
                database.equipos[index] = equipo;
                showNotification('‚úÖ Equipo actualizado');
            } else {
                database.equipos.push(equipo);
                showNotification('‚úÖ Equipo creado');
            }
            
            saveData();
            renderEquipos();
            updateDashboard();
            closeModal('modalEquipo');
        }

        function renderEquipos() {
            const tbody = document.getElementById('equiposTableBody');
            
            if (database.equipos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-state-icon">üíª</div>
                            <h3>No hay equipos registrados</h3>
                            <p>Haz clic en "Nuevo Equipo" para comenzar</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = database.equipos.map(eq => {
                const asignacion = database.asignaciones.find(a => 
                    a.equipoId === eq._id && a.estado === 'Activa'
                );
                
                const colaborador = asignacion ? 
                    database.colaboradores.find(c => c._id === asignacion.colaboradorId) : null;
                
                let estadoBadge = '';
                switch(eq.estado) {
                    case 'Disponible':
                        estadoBadge = '<span class="badge badge-success">Disponible</span>';
                        break;
                    case 'Asignado':
                        estadoBadge = '<span class="badge badge-info">Asignado</span>';
                        break;
                    case 'Mantenimiento':
                        estadoBadge = '<span class="badge badge-warning">Mantenimiento</span>';
                        break;
                    case 'Baja':
                        estadoBadge = '<span class="badge badge-danger">Baja</span>';
                        break;
                }
                
                return `
                    <tr>
                        <td><strong>${eq.marca}</strong></td>
                        <td>${eq.modelo}</td>
                        <td>${eq.tipo}</td>
                        <td>${eq.numSerie}</td>
                        <td>${estadoBadge}</td>
                        <td>${colaborador ? colaborador.nombre : '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick='editEquipo("${eq._id}")'>‚úèÔ∏è Editar</button>
                            <button class="btn btn-sm btn-danger" onclick='deleteEquipo("${eq._id}")'>üóëÔ∏è Eliminar</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function editEquipo(id) {
            const equipo = database.equipos.find(e => e._id === id);
            
            document.getElementById('equipoId').value = equipo._id;
            document.getElementById('equipoTipo').value = equipo.tipo;
            document.getElementById('equipoMarca').value = equipo.marca;
            document.getElementById('equipoModelo').value = equipo.modelo;
            document.getElementById('equipoNumSerie').value = equipo.numSerie;
            document.getElementById('equipoProcesador').value = equipo.especificaciones.procesador || '';
            document.getElementById('equipoRam').value = equipo.especificaciones.ram || '';
            document.getElementById('equipoAlmacenamiento').value = equipo.especificaciones.almacenamiento || '';
            document.getElementById('equipoSO').value = equipo.especificaciones.sistemaOperativo || '';
            document.getElementById('equipoFechaCompra').value = equipo.fechaCompra || '';
            document.getElementById('equipoEstado').value = equipo.estado;
            document.getElementById('equipoObservaciones').value = equipo.observaciones || '';
            
            document.getElementById('modalEquipoTitle').textContent = 'Editar Equipo';
            openModal('modalEquipo');
        }

        function deleteEquipo(id) {
            const asignaciones = database.asignaciones.filter(a => a.equipoId === id && a.estado === 'Activa');
            
            if (asignaciones.length > 0) {
                showNotification('‚ùå No se puede eliminar. El equipo est√° asignado.', 'error');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de eliminar este equipo?')) {
                database.equipos = database.equipos.filter(e => e._id !== id);
                saveData();
                renderEquipos();
                updateDashboard();
                showNotification('‚úÖ Equipo eliminado');
            }
        }

        function filterEquipos() {
            const searchTerm = document.getElementById('searchEquipo').value.toLowerCase();
            const rows = document.querySelectorAll('#equiposTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // ASIGNACIONES
        function updateAsignacionSelects() {
            const selectColaborador = document.getElementById('asignacionColaborador');
            const selectEquipo = document.getElementById('asignacionEquipo');
            
            selectColaborador.innerHTML = '<option value="">Seleccionar colaborador...</option>' +
                database.colaboradores.map(col => 
                    `<option value="${col._id}">${col.nombre} - ${col.departamento}</option>`
                ).join('');
            
            const equiposDisponibles = database.equipos.filter(eq => eq.estado === 'Disponible');
            selectEquipo.innerHTML = '<option value="">Seleccionar equipo...</option>' +
                equiposDisponibles.map(eq => 
                    `<option value="${eq._id}">${eq.marca} ${eq.modelo} (${eq.tipo}) - ${eq.numSerie}</option>`
                ).join('');
        }

        function saveAsignacion(event) {
            event.preventDefault();
            
            const colaboradorId = document.getElementById('asignacionColaborador').value;
            const equipoId = document.getElementById('asignacionEquipo').value;
            
            const asignacion = {
                _id: 'ASG' + Date.now(),
                colaboradorId: colaboradorId,
                equipoId: equipoId,
                fechaAsignacion: document.getElementById('asignacionFecha').value,
                fechaDevolucion: null,
                estado: document.getElementById('asignacionEstado').value,
                observaciones: document.getElementById('asignacionObservaciones').value,
                createdAt: new Date().toISOString()
            };
            
            database.asignaciones.push(asignacion);
            
            const equipo = database.equipos.find(e => e._id === equipoId);
            equipo.estado = 'Asignado';
            
            saveData();
            renderAsignaciones();
            renderEquipos();
            updateDashboard();
            closeModal('modalAsignacion');
            showNotification('‚úÖ Equipo asignado correctamente');
        }

        function renderAsignaciones() {
            const tbody = document.getElementById('asignacionesTableBody');
            
            if (database.asignaciones.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-state-icon">üîó</div>
                            <h3>No hay asignaciones registradas</h3>
                            <p>Haz clic en "Nueva Asignaci√≥n" para comenzar</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = database.asignaciones.map(asig => {
                const colaborador = database.colaboradores.find(c => c._id === asig.colaboradorId);
                const equipo = database.equipos.find(e => e._id === asig.equipoId);
                
                const estadoBadge = asig.estado === 'Activa' ? 
                    '<span class="badge badge-success">Activa</span>' : 
                    '<span class="badge badge-warning">Devuelto</span>';
                
                return `
                    <tr>
                        <td><strong>${colaborador ? colaborador.nombre : 'N/A'}</strong></td>
                        <td>${equipo ? `${equipo.marca} ${equipo.modelo}` : 'N/A'}</td>
                        <td>${new Date(asig.fechaAsignacion).toLocaleDateString()}</td>
                        <td>${asig.fechaDevolucion ? new Date(asig.fechaDevolucion).toLocaleDateString() : '-'}</td>
                        <td>${estadoBadge}</td>
                        <td>${asig.observaciones || '-'}</td>
                        <td class="action-buttons">
                            ${asig.estado === 'Activa' ? 
                                `<button class="btn btn-sm btn-warning" onclick='devolverEquipo("${asig._id}")'>‚Ü©Ô∏è Devolver</button>` : 
                                ''
                            }
                            <button class="btn btn-sm btn-danger" onclick='deleteAsignacion("${asig._id}")'>üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            updateDashboardTable();
        }

        function devolverEquipo(asignacionId) {
            if (confirm('¬øConfirmar devoluci√≥n del equipo?')) {
                const asignacion = database.asignaciones.find(a => a._id === asignacionId);
                asignacion.estado = 'Devuelto';
                asignacion.fechaDevolucion = new Date().toISOString().split('T')[0];
                
                const equipo = database.equipos.find(e => e._id === asignacion.equipoId);
                equipo.estado = 'Disponible';
                
                saveData();
                renderAsignaciones();
                renderEquipos();
                updateDashboard();
                showNotification('‚úÖ Equipo devuelto correctamente');
            }
        }

        function deleteAsignacion(id) {
            if (confirm('¬øEst√°s seguro de eliminar esta asignaci√≥n?')) {
                const asignacion = database.asignaciones.find(a => a._id === id);
                
                if (asignacion.estado === 'Activa') {
                    const equipo = database.equipos.find(e => e._id === asignacion.equipoId);
                    equipo.estado = 'Disponible';
                }
                
                database.asignaciones = database.asignaciones.filter(a => a._id !== id);
                saveData();
                renderAsignaciones();
                renderEquipos();
                updateDashboard();
                showNotification('‚úÖ Asignaci√≥n eliminada');
            }
        }

        // DASHBOARD
        function updateDashboard() {
            document.getElementById('totalColaboradores').textContent = database.colaboradores.length;
            document.getElementById('totalEquipos').textContent = database.equipos.length;
            
            const asignados = database.asignaciones.filter(a => a.estado === 'Activa').length;
            document.getElementById('equiposAsignados').textContent = asignados;
            document.getElementById('equiposDisponibles').textContent = 
                database.equipos.filter(e => e.estado === 'Disponible').length;
        }

        function updateDashboardTable() {
            const tbody = document.getElementById('dashboardTableBody');
            const asignacionesActivas = database.asignaciones
                .filter(a => a.estado === 'Activa')
                .slice(-5)
                .reverse();
            
            if (asignacionesActivas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <h3>No hay asignaciones a√∫n</h3>
                            <p>Comienza creando colaboradores y equipos</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = asignacionesActivas.map(asig => {
                const colaborador = database.colaboradores.find(c => c._id === asig.colaboradorId);
                const equipo = database.equipos.find(e => e._id === asig.equipoId);
                
                return `
                    <tr>
                        <td><strong>${colaborador ? colaborador.nombre : 'N/A'}</strong></td>
                        <td>${equipo ? `${equipo.marca} ${equipo.modelo}` : 'N/A'}</td>
                        <td>${equipo ? equipo.tipo : 'N/A'}</td>
                        <td>${new Date(asig.fechaAsignacion).toLocaleDateString()}</td>
                        <td><span class="badge badge-success">Activa</span></td>
                    </tr>
                `;
            }).join('');
        }

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        // Cargar datos al iniciar
        window.onload = loadData;
    </script>
</body>
</html>